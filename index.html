<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>LitShark Services</title>
  <style>
    /* Reset and basic typography */
    body, h1, h2, h3, p, ul, li, a {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    body {
      line-height: 1.6;
      background-color: #fff;
      color: #000;
    }
    /* Header */
    header {
      background: #333;
      color: #fff;
      padding: 15px;
    }
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header-container h1 {
      margin: 0;
    }
    .header-images {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .header-logo {
      width: 80px;
      height: auto;
    }
    .profile-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
    }
    /* Navigation (placed below header) */
    nav {
      background: #444;
      padding: 10px;
      text-align: center;
      position: relative;
    }
    nav a {
      color: #fff;
      margin: 0 15px;
      text-decoration: none;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    /* Settings Dropdown (on same y-axis as nav links) */
    #settingsMenu {
      display: inline-block;
      vertical-align: middle;
      margin-left: 20px;
    }
    #settingsButton {
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    #settingsDropdown {
      display: none;
      position: absolute;
      right: 10px;
      top: 40px;
      background: #fff;
      color: #000;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      z-index: 200;
    }
    /* iOS-style toggle switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 28px;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 28px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #2196F3;
    }
    input:checked + .slider:before {
      transform: translateX(22px);
    }
    /* Sections */
    section {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    h2 {
      margin-bottom: 10px;
    }
    /* Services Grid and Boxes */
    .services-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
      margin-bottom: 30px;
    }
    .service-box {
      width: 250px;
      border: 1px solid #ccc;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      text-align: center;
      transition: transform 0.2s;
      background: #fff;
    }
    .service-box:hover {
      transform: scale(1.05);
    }
    .service-box img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      object-position: center;
      display: block;
    }
    .service-title {
      padding: 10px;
      background: #f7f7f7;
      color: #000;
      font-size: 1.2em;
    }
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 600px;
      border-radius: 8px;
      position: relative;
    }
    .modal-content h2 {
      margin-top: 0;
      margin-bottom: 10px;
    }
    .modal-content h3 {
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }
    .job-images {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .job-images img {
      width: 48%;
      object-fit: cover;
      object-position: center;
    }
    /* Wrap Recent Jobs section so it can be hidden entirely */
    .recent-jobs-section {
      margin-top: 20px;
    }
    /* Table Styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    table thead tr {
      background-color: #f0f0f0;
    }
    table th, table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    /* Contact Section */
    .contact-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .contact-item img {
      margin-right: 10px;
      width: 24px;
      height: 24px;
      object-fit: contain;
    }
    /* DARK MODE OVERRIDES (system-based) */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #121212;
        color: #eee;
      }
      header {
        background: #222;
      }
      nav {
        background: #333;
      }
      .service-box {
        background: #333;
        border-color: #444;
      }
      .service-title {
        background: #444;
        color: #eee;
      }
      .modal-content {
        background-color: #222;
        color: #fff;
        border-color: #555;
      }
      table thead tr {
        background-color: #333;
      }
      table th, table td {
        border-color: #555;
      }
      .header-logo, .contact-item img {
        filter: invert(1);
      }
      #settingsDropdown {
        background: #333;
        color: #eee;
        border-color: #555;
      }
    }
    /* MANUAL OVERRIDES */
    body.force-dark {
      background-color: #121212 !important;
      color: #eee !important;
    }
    body.force-dark header { background: #222 !important; }
    body.force-dark nav { background: #333 !important; }
    body.force-dark .service-box {
      background: #333 !important;
      border-color: #444 !important;
    }
    body.force-dark .service-title {
      background: #444 !important;
      color: #eee !important;
    }
    body.force-dark .modal-content {
      background-color: #222 !important;
      color: #fff !important;
      border-color: #555 !important;
    }
    body.force-dark table thead tr {
      background-color: #333 !important;
    }
    body.force-dark table th, body.force-dark table td {
      border-color: #555 !important;
    }
    body.force-dark .header-logo, body.force-dark .contact-item img {
      filter: invert(1) !important;
    }
    body.force-dark #settingsDropdown {
      background: #333 !important;
      color: #eee !important;
      border-color: #555 !important;
    }
    body.force-light {
      background-color: #fff !important;
      color: #000 !important;
    }
    body.force-light header { background: #333 !important; }
    body.force-light nav { background: #444 !important; }
    body.force-light .service-box {
      background: #fff !important;
      border-color: #ccc !important;
    }
    body.force-light .service-title {
      background: #f7f7f7 !important;
      color: #000 !important;
    }
    body.force-light .modal-content {
      background-color: #fff !important;
      color: #000 !important;
      border-color: #888 !important;
    }
    body.force-light table thead tr {
      background-color: #f0f0f0 !important;
    }
    body.force-light table th, body.force-light table td {
      border-color: #ccc !important;
    }
    body.force-light .header-logo, body.force-light .contact-item img {
      filter: none !important;
    }
    body.force-light #settingsDropdown {
      background: #fff !important;
      color: #000 !important;
      border-color: #ccc !important;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-container">
      <h1>LitShark Services</h1>
      <div class="header-images">
        <img src="images/logo.png" alt="Logo" class="header-logo">
        <img src="images/me.png" alt="Max Uribe" class="profile-photo">
      </div>
    </div>
  </header>
  
  <!-- Navigation (placed below header) -->
  <nav>
    <a href="#services">Services</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
    <div id="settingsMenu">
      <button id="settingsButton">Settings &#9662;</button>
      <div id="settingsDropdown">
        <label class="toggle-switch">
          <input type="checkbox" id="modeToggle">
          <span class="slider"></span>
        </label>
        <span id="modeLabel">Dark Mode</span>
      </div>
    </div>
  </nav>
  
  <!-- Services Section -->
  <section id="services">
    <h2>Services</h2>
    <!-- Regular Services -->
    <h3>Regular Services</h3>
    <div class="services-grid">
      <div class="service-box" data-modal="modal-snow">
        <img src="images/snow-removal.jpg" alt="Snow Removal">
        <div class="service-title">Snow Removal</div>
      </div>
      <div class="service-box" data-modal="modal-window">
        <img src="images/window-cleaning.jpg" alt="Window Cleaning">
        <div class="service-title">Window Cleaning</div>
      </div>
      <div class="service-box" data-modal="modal-painting">
        <img src="images/painting.jpg" alt="Painting">
        <div class="service-title">Painting</div>
      </div>
      <div class="service-box" data-modal="modal-3d">
        <img src="images/3d-printing.png" alt="3D Design & Printing">
        <div class="service-title">3D Design & Printing</div>
      </div>
      <div class="service-box" data-modal="modal-webdesign">
        <img src="images/web-design.png" alt="Web Design">
        <div class="service-title">Web Design</div>
      </div>
    </div>
    <!-- Irregular Work -->
    <h3>Irregular Work</h3>
    <p>
      Limited availability due to school and set-up time. However, I can always refer you to an affiliated full-time contractor, electrician, etc., if needed.
    </p>
    <div class="services-grid">
      <div class="service-box" data-modal="modal-home">
        <img src="images/home-finishing.jpg" alt="Home Finishing">
        <div class="service-title">Home Finishing</div>
      </div>
      <div class="service-box" data-modal="modal-drywall">
        <img src="images/drywall-framing.jpg" alt="Drywalling/Framing">
        <div class="service-title">Drywalling/Framing</div>
      </div>
      <div class="service-box" data-modal="modal-plumbing">
        <img src="images/plumbing.jpg" alt="Plumbing">
        <div class="service-title">Plumbing</div>
      </div>
      <div class="service-box" data-modal="modal-electrician">
        <img src="images/electrician.jpg" alt="Electrician">
        <div class="service-title">Electrician</div>
      </div>
      <div class="service-box" data-modal="modal-blade">
        <img src="images/blade-smithing.jpg" alt="Blade Smithing">
        <div class="service-title">Blade Smithing</div>
      </div>
      <div class="service-box" data-modal="modal-flooring">
        <img src="images/flooring.jpg" alt="Flooring">
        <div class="service-title">Flooring</div>
      </div>
    </div>
  </section>
  
  <!-- About Section -->
  <section id="about">
    <h2>About</h2>
    <p>
      Hi, I'm Max Uribe. I handle snow removal, window cleaning, painting, and small home repairs on a personal, one-on-one basis.
      I believe in straightforward service without unnecessary fuss. For smaller tasks, I take care of everything myself,
      and for larger projects, I refer you to trusted affiliates who share my commitment to quality work.
      Thank you for considering my services—I look forward to helping keep your property in top shape.
    </p>
  </section>
  
  <!-- Contact Section -->
  <section id="contact">
    <h2>Contact</h2>
    <div class="contact-item">
      <img src="images/email-icon.png" alt="Email Icon">
      <span>uribemax1013@gmail.com</span>
    </div>
    <div class="contact-item">
      <img src="images/phone-icon.png" alt="Phone Icon">
      <span>437-881-1611</span>
    </div>
    <div class="contact-item">
      <img src="images/website-icon.png" alt="Website Icon">
      <span>
        <a href="https://litshark.ca" target="_blank" style="color:inherit; text-decoration:none;">litshark.ca</a>
      </span>
    </div>
  </section>
  
  <!-- Modal Definitions -->
  <!-- Snow Removal Modal -->
  <div id="modal-snow" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Snow Removal</h2>
      <p>
        I personally clear driveways, walkways, and small parking areas during the winter.
        When heavy snow or ice hits, you can count on me to keep your property safe and accessible—handled one-on-one.
      </p>
      <h3>Availability</h3>
      <ul>
        <li>Mon-Thurs: after 3:00pm</li>
        <li>Sat: after 7:00pm</li>
        <li>Sun: All day</li>
      </ul>
      <h3>Prices</h3>
      <h4>Integrated Apartment-House</h4>
      <p><em>"Compact Front-Entry Home"</em></p>
      <p>
        A conjoined apartment or townhouse with no driveway after the sidewalk.
        The entrance typically consists of house steps or a porch (1-2 meters).
      </p>
      <table>
        <thead>
          <tr>
            <th>Area</th>
            <th>Cost</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1 car driveway</td>
            <td>$25</td>
          </tr>
          <tr>
            <td>Entry path/steps (clear a walk path)</td>
            <td>$5</td>
          </tr>
          <tr>
            <td>Entry path/steps (clear entire pathway edge to edge)</td>
            <td>$10</td>
          </tr>
        </tbody>
      </table>
      <h4>Extended Driveway Home</h4>
      <p><em>"Spacious Entryway Home"</em></p>
      <p>
        A detached or semi-detached house with a continued driveway after the sidewalk
        and featuring a porch, steps, or pathway over 2 meters.
      </p>
      <table>
        <thead>
          <tr>
            <th>Area</th>
            <th>Cost</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1 car driveway</td>
            <td>$30</td>
          </tr>
          <tr>
            <td>2 car driveway</td>
            <td>$50</td>
          </tr>
          <tr>
            <td>Entryway/steps (clear a walk path)</td>
            <td>$10</td>
          </tr>
          <tr>
            <td>Entryway/steps (clear entire pathway edge to edge)</td>
            <td>$20</td>
          </tr>
        </tbody>
      </table>
      <div class="recent-jobs-section">
        <h3>Recent Jobs</h3>
        <div class="job-images">
          <img src="images/snow-removal-before.jpg" alt="Before" onerror="this.closest('.recent-jobs-section').style.display='none';">
          <img src="images/snow-removal-after.jpg" alt="After" onerror="this.closest('.recent-jobs-section').style.display='none';">
        </div>
      </div>
    </div>
  </div>
  
  <!-- Window Cleaning Modal -->
  <div id="modal-window" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Window Cleaning</h2>
      <p>
        Enjoy sparkling windows without the fuss. I clean both the inside and outside of your windows,
        removing dirt and streaks so you get a clear view.
      </p>
      <h3>Availability</h3>
      <p>Upon request during summer; limited availability outside season.</p>
      <h3>Prices</h3>
      <p>Upon quote.</p>
      <div class="recent-jobs-section">
        <h3>Recent Jobs</h3>
        <div class="job-images">
          <img src="images/window-cleaning-before.jpg" alt="Before" onerror="this.closest('.recent-jobs-section').style.display='none';">
          <img src="images/window-cleaning-after.jpg" alt="After" onerror="this.closest('.recent-jobs-section').style.display='none';">
        </div>
      </div>
    </div>
  </div>
  
  <!-- Painting Modal -->
  <div id="modal-painting" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Painting</h2>
      <p>
        I offer personalized painting services for interiors and exteriors to refresh your space.
      </p>
      <h3>Availability</h3>
      <p>Upon request during summer; limited availability outside season.</p>
      <h3>Prices</h3>
      <p>Upon quote.</p>
      <div class="recent-jobs-section">
        <h3>Recent Jobs</h3>
        <div class="job-images">
          <img src="images/painting-before.jpg" alt="Before" onerror="this.closest('.recent-jobs-section').style.display='none';">
          <img src="images/painting-after.jpg" alt="After" onerror="this.closest('.recent-jobs-section').style.display='none';">
        </div>
      </div>
    </div>
  </div>
  
  <!-- 3D Design & Printing Modal (No Recent Jobs) -->
  <div id="modal-3d" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>3D Design & Printing</h2>
      <p>
        I offer 3D design and printing for custom projects. I work with you to create digital models and produce prints for prototypes, parts, or creative projects.
      </p>
      <h3>Availability</h3>
      <p>Available upon request. Turnaround time varies by project complexity.</p>
      <h3>Prices</h3>
      <p>Pricing depends on design complexity, print size, and materials. Please contact me for a quote.</p>
    </div>
  </div>
  
  <!-- Web Design Modal (No Recent Jobs) -->
  <div id="modal-webdesign" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Web Design</h2>
      <p>
        I provide clean, simple web design solutions tailored to your needs.
        The approach is straightforward and functional.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Upon quote.</p>
    </div>
  </div>
  
  <!-- Home Finishing Modal -->
  <div id="modal-home" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Home Finishing</h2>
      <p>
        Need a final touch for your home? I handle small carpentry fixes, trim work, or other finishing touches.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <div class="recent-jobs-section">
        <h3>Recent Jobs</h3>
        <div class="job-images">
          <img src="images/home-finishing-before.jpg" alt="Before" onerror="this.closest('.recent-jobs-section').style.display='none';">
          <img src="images/home-finishing-after.jpg" alt="After" onerror="this.closest('.recent-jobs-section').style.display='none';">
        </div>
      </div>
    </div>
  </div>
  
  <!-- Drywalling/Framing Modal -->
  <div id="modal-drywall" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Drywalling/Framing</h2>
      <p>
        I handle small drywall patches and framing work. For larger jobs, I can refer you to a trusted contractor.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <div class="recent-jobs-section">
        <h3>Recent Jobs</h3>
        <div class="job-images">
          <img src="images/drywall-framing-before.jpg" alt="Before" onerror="this.closest('.recent-jobs-section').style.display='none';">
          <img src="images/drywall-framing-after.jpg" alt="After" onerror="this.closest('.recent-jobs-section').style.display='none';">
        </div>
      </div>
    </div>
  </div>
  
  <!-- Plumbing Modal -->
  <div id="modal-plumbing" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Plumbing</h2>
      <p>
        Got a minor leak or a simple plumbing fix? I handle small issues or connect you with a reliable plumber for bigger tasks.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <div class="recent-jobs-section">
        <h3>Recent Jobs</h3>
        <div class="job-images">
          <img src="images/plumbing-before.jpg" alt="Before" onerror="this.closest('.recent-jobs-section').style.display='none';">
          <img src="images/plumbing-after.jpg" alt="After" onerror="this.closest('.recent-jobs-section').style.display='none';">
        </div>
      </div>
    </div>
  </div>
  
  <!-- Electrician Modal -->
  <div id="modal-electrician" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Electrician</h2>
      <p>
        I can help with quick electrical fixes like installing light fixtures or troubleshooting minor issues.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <div class="recent-jobs-section">
        <h3>Recent Jobs</h3>
        <div class="job-images">
          <img src="images/electrician-before.jpg" alt="Before" onerror="this.closest('.recent-jobs-section').style.display='none';">
          <img src="images/electrician-after.jpg" alt="After" onerror="this.closest('.recent-jobs-section').style.display='none';">
        </div>
      </div>
    </div>
  </div>
  
  <!-- Blade Smithing Modal -->
  <div id="modal-blade" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Blade Smithing</h2>
      <p>
        I craft custom blades as a side hobby during the summer. I can provide a strong, long-lasting blade from your chosen materials.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <div class="recent-jobs-section">
        <h3>Recent Jobs</h3>
        <div class="job-images">
          <img src="images/blade-smithing-before.jpg" alt="Before" onerror="this.closest('.recent-jobs-section').style.display='none';">
          <img src="images/blade-smithing-after.jpg" alt="After" onerror="this.closest('.recent-jobs-section').style.display='none';">
        </div>
      </div>
    </div>
  </div>
  
  <!-- Flooring Modal -->
  <div id="modal-flooring" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Flooring</h2>
      <p>
        I provide flooring installation and repair services. Whether it's a repair or a new installation, I handle the work with care and for larger projects, can refer you to a trusted specialist.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <div class="recent-jobs-section">
        <h3>Recent Jobs</h3>
        <div class="job-images">
          <img src="images/flooring-before.jpg" alt="Before" onerror="this.closest('.recent-jobs-section').style.display='none';">
          <img src="images/flooring-after.jpg" alt="After" onerror="this.closest('.recent-jobs-section').style.display='none';">
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal Event Listeners -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Add click listeners for service boxes to show modals
      document.querySelectorAll('.service-box').forEach(box => {
        box.addEventListener('click', () => {
          const modalId = box.getAttribute('data-modal');
          const modal = document.getElementById(modalId);
          if (modal) {
            modal.style.display = 'block';
          }
        });
      });
      
      // Add click listeners for modal close buttons
      document.querySelectorAll('.modal .close').forEach(btn => {
        btn.addEventListener('click', () => {
          const modal = btn.closest('.modal');
          modal.style.display = 'none';
        });
      });
      
      // Hide modal when clicking outside the modal content
      window.addEventListener('click', (event) => {
        if (event.target.classList.contains('modal')) {
          event.target.style.display = 'none';
        }
      });
      
      // Settings Dropdown Toggle
      document.getElementById("settingsButton").addEventListener("click", function() {
        var dropdown = document.getElementById("settingsDropdown");
        if (dropdown.style.display === "none" || dropdown.style.display === "") {
          dropdown.style.display = "block";
        } else {
          dropdown.style.display = "none";
        }
      });
      
      // Dark/Light Mode Toggle
      document.getElementById("modeToggle").addEventListener("change", function() {
        if (this.checked) {
          document.body.classList.add("force-dark");
          document.body.classList.remove("force-light");
        } else {
          document.body.classList.add("force-light");
          document.body.classList.remove("force-dark");
        }
      });
    });
  </script>
  
  <!-- Google Sheets Analytics Logging Script -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/10.5.18/jsrsasign-all-min.js"></script>
  <script>
    // Function to fetch the public IP using an external service
    async function fetchIP() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        return data.ip;
      } catch (err) {
        console.error("Failed to fetch IP:", err);
        return "Unavailable";
      }
    }
    
    // Generate or retrieve a unique device ID stored in localStorage
    function getDeviceId() {
      let deviceId = localStorage.getItem("deviceId");
      if (!deviceId) {
        deviceId = "device-" + Math.random().toString(36).substr(2, 10);
        localStorage.setItem("deviceId", deviceId);
      }
      return deviceId;
    }
    
    // Retrieve and increment the visit count for this device
    function getVisitCount() {
      let count = parseInt(localStorage.getItem("visitCount") || "0", 10);
      count++;
      localStorage.setItem("visitCount", count);
      return count;
    }
    
    async function getAccessToken() {
      const header = { alg: "RS256", typ: "JWT" };
      const now = KJUR.jws.IntDate.get('now');
      const exp = now + 3600; // 1 hour expiry
      const payload = {
        iss: "litshark-service@litshark-451902.iam.gserviceaccount.com",
        scope: "https://www.googleapis.com/auth/spreadsheets",
        aud: "https://oauth2.googleapis.com/token",
        iat: now,
        exp: exp
      };
      const sHeader = JSON.stringify(header);
      const sPayload = JSON.stringify(payload);
      const privateKey = `-----BEGIN PRIVATE KEY-----
MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQCMLMbSG1JxS+zo
KDmicTgHxmJEnB0zOv1y6X/3S19wVlCSVMOrMzG7SZad5vwHEEBbdvlodLhIK965
eLf79ymKH5t10uQ4+/WGkljNQdrYjDzGaZ4zk0Z6qmK+7EQTphf1O8pZLmzzyVq+
QZLutjRRwMVrilVYdePr5mq36GcgYV0UUulsMIvrbNkxkYv/DV/0FgiwaAEEcaX6
53ucRhysfJYlMYoeD0lY+fQtLgtJfgraZAl9V/6bwQeC+vLsz+mopzmliAvTr8LN
j0YMNNyL4wtgarhCUtYD3uWZTPpocbYwLUzfdItlEdrsTLvOZ1z7HrgKiHvEyI3R
g/+a6Zi5AgMBAAECggEABB+tGbFEE6EwLwQ/7c923oOvkGUnVsJ9gkvsP9Iv1JY1
eJiVyQuQgvn/PFX3RB3uRsKRQ8lrQnRH8RzkDL2Qs0eKw0SZAjQnXPYhNqihT42Q
nCWvScUjZahtj0BUIF/ahJRlt4nuGp3p1X8IW41wrJcHN8qyCBAvzFjS+uYTYphv
hsL0ONdTIEtMZhTy1GnPhU93Fl1w+v0RlPniM0xBavZdNDSxUlc1aSbYEbdoXckI
W9P+90m+zhrpEAnc4cNZqab9JK18NgNwyQTY2xXMSa4X5MgMaJ9zq8NeEa797U5x
f+gTg8q2+eLDJ/hLby7+MhF3/+XviyD2QnvVmtm8gQKBgQDA7ILthmZcgobb2KVQ
sz7vMqAGbEF1AxFFOeRUNtR8qEzP0Z3aio0r3oUfGp/hgXwt/quk+8Vd+yJ0QuLE
3gxhzLoJbSI3TuTs0zmvjOLrUc6KxYvgXWFuu4xhzRsL6JVB193KpN1YGM9I/f2G
7lz+mUjnyTSxZW9Sf6SKybZnhQKBgQC6AT4Pk4a8vQZLxReplpv+JoIr+1EfmYky
zlx9z9940TpgAphDWyOb1k5t9fG8vkLn5cO0zOW8Q/oJ1Gtxj0ObYJ6+Et7OvjMY
TpDTDdbOPgNMLGe24C5xemAUp2goWho5FB4w/CdMLklWFSdzndv6ZAEXPmor9Q6w
xWEJtJtgpQKBgQCH2EIdBI0hSNuzBCrr1ztSbOBXhXTV8vH/P9NyJSWcHVnw39X6
I6NiJ46vJy07OdT6AiBUzN/d3E8XdF1/aCdp2iGJL6pvLYNu6xDsdxT1xCXee1mS
A87ujOs9lpIb4Yrv0ROgdFRTiyyyZf5WO5OJxt+aLoiG/TjU64IuI/jnjQKBgQCX
0PnJltzrYdEouOaWWcJazy2CHm9ZPmT4HezqF2fL4eImiRekKlhHEsUTBSHYruZH
BocVJAQDBOypZ0KG/qrswBDxDM/kqONlXILicLI5xe3FF51Ta2kc4AhZ80WVYe1z
VxNJYhXlHQZoh32a5Wat2T/2q8/Wrv7dk0yfslT7rQKBgQCoYJSYKH06Ur0SCT5i
X+zScnAUFoPYIIq8AoD9lf2G9Ac0TZ1dcm47QhUEL4YYtPi/6Dua5dZeYSZfxUoy
0T72BqFsJvVH2fBIAKGNChRcMTpKEgOz1563cFsKUtg9qmlActSylbyht50Z5Cdv
Ooyha/q7K4YE1Sz6Cuut69pLkw==\n-----END PRIVATE KEY-----\n`;
      
      const jwt = KJUR.jws.JWS.sign("RS256", sHeader, sPayload, privateKey);
      
      const response = await fetch("https://oauth2.googleapis.com/token", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&assertion=${jwt}`
      });
      
      const data = await response.json();
      return data.access_token;
    }
    
    async function logVisit() {
      try {
        const token = await getAccessToken();
        const spreadsheetId = "1KRQhdKB7LBT-gbpNM3snmDYzalpl3cdoYBWv_gKNXjE";
        const sheetName = "Analytics"; // Ensure your Google Sheet has a tab named "Analytics"
        const now = new Date().toISOString();
        
        // Fetch client IP address
        const ip = await fetchIP();
        // Retrieve or generate device ID
        const deviceId = getDeviceId();
        // Get visit count for this device
        const visitCount = getVisitCount();
        
        // Prepare data row: timestamp, URL, user agent, IP, deviceId, visit count
        const values = [[now, window.location.href, navigator.userAgent, ip, deviceId, visitCount]];
        
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}!A:F:append?valueInputOption=USER_ENTERED&insertDataOption=INSERT_ROWS`;
        const res = await fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
          },
          body: JSON.stringify({ values })
        });
        const result = await res.json();
        console.log("Logged visit:", result);
      } catch (err) {
        console.error("Error logging visit:", err);
      }
    }
    
    // Fetch public IP address
    async function fetchIP() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        return data.ip;
      } catch (err) {
        console.error("Failed to fetch IP:", err);
        return "Unavailable";
      }
    }
    
    // Generate or retrieve device ID
    function getDeviceId() {
      let deviceId = localStorage.getItem("deviceId");
      if (!deviceId) {
        deviceId = "device-" + Math.random().toString(36).substr(2, 10);
        localStorage.setItem("deviceId", deviceId);
      }
      return deviceId;
    }
    
    // Retrieve and increment visit count for this device
    function getVisitCount() {
      let count = parseInt(localStorage.getItem("visitCount") || "0", 10);
      count++;
      localStorage.setItem("visitCount", count);
      return count;
    }
    
    window.addEventListener("load", logVisit);
  </script>
</body>
</html>
