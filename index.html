<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>LitShark Services</title>
  <style>
    /* Reset & Basic Typography */
    body, h1, h2, h3, p, ul, li, a {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    body {
      line-height: 1.6;
      background-color: #fff;
      color: #000;
    }
    /* Header & Navigation */
    header {
      background: #333;
      color: #fff;
      padding: 15px;
    }
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header-container h1 {
      margin: 0;
    }
    .header-images {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .header-logo {
      width: 80px;
      height: auto;
    }
    .profile-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
    }
    nav {
      background: #444;
      padding: 10px;
      text-align: center;
    }
    nav a {
      color: #fff;
      margin: 0 15px;
      text-decoration: none;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    /* Sections */
    section {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    h2 {
      margin-bottom: 10px;
    }
    /* Services Grid & Boxes */
    .services-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: center;
      margin-bottom: 30px;
    }
    .service-box {
      width: 250px;
      border: 1px solid #ccc;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      text-align: center;
      transition: transform 0.2s;
      background: #fff;
    }
    .service-box:hover {
      transform: scale(1.05);
    }
    .service-box img {
      width: 100%;
      height: 250px; /* force square */
      object-fit: cover;
      object-position: center;
      display: block;
    }
    .service-title {
      padding: 10px;
      background: #f7f7f7;
      font-size: 1.2em;
      color: #000;
    }
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 600px;
      border-radius: 8px;
      position: relative;
      color: #000;
    }
    .modal-content h2 {
      margin-top: 0;
      margin-bottom: 10px;
    }
    .modal-content h3 {
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }
    .job-images {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .job-images img {
      width: 48%;
      object-fit: cover;
      object-position: center;
    }
    /* Table Styles (Snow Removal) */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    table thead tr {
      background-color: #f0f0f0;
    }
    table th, table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    /* Contact Section */
    .contact-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .contact-item img {
      margin-right: 10px;
      width: 24px;
      height: 24px;
      object-fit: contain;
    }
    
    /* DARK MODE OVERRIDES */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #121212;
        color: #eee;
      }
      header {
        background: #222;
      }
      nav {
        background: #333;
      }
      .service-box {
        background: #333;
        border-color: #555;
      }
      .service-title {
        background: #444;
        color: #eee;
      }
      .modal-content {
        background-color: #222;
        color: #fff;
        border-color: #555;
      }
      table thead tr {
        background-color: #333;
      }
      table th, table td {
        border-color: #555;
      }
      /* Invert logo colors in dark mode */
      .header-logo {
        filter: invert(1);
      }
    }
  </style>
</head>
<body>
  <!-- Header & Navigation -->
  <header>
    <div class="header-container">
      <h1>LitShark Services</h1>
      <div class="header-images">
        <img src="images/logo.png" alt="Logo" class="header-logo">
        <img src="images/me.png" alt="Max Uribe" class="profile-photo">
      </div>
    </div>
  </header>
  <nav>
    <a href="#services">Services</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
  </nav>
  
  <!-- Services Section -->
  <section id="services">
    <h2>Services</h2>
    
    <!-- Regular Services -->
    <h3>Regular Services</h3>
    <div class="services-grid">
      <div class="service-box" data-modal="modal-snow">
        <img src="images/snow-removal.jpg" alt="Snow Removal">
        <div class="service-title">Snow Removal</div>
      </div>
      <div class="service-box" data-modal="modal-window">
        <img src="images/window-cleaning.jpg" alt="Window Cleaning">
        <div class="service-title">Window Cleaning</div>
      </div>
      <div class="service-box" data-modal="modal-painting">
        <img src="images/painting.jpg" alt="Painting">
        <div class="service-title">Painting</div>
      </div>
      <div class="service-box" data-modal="modal-3d">
        <img src="images/3d-printing.png" alt="3D Design & Printing">
        <div class="service-title">3D Design & Printing</div>
      </div>
      <div class="service-box" data-modal="modal-webdesign">
        <img src="images/web-design.png" alt="Web Design">
        <div class="service-title">Web Design</div>
      </div>
    </div>
    
    <!-- Irregular Work -->
    <h3>Irregular Work</h3>
    <p>
      Limited availability due to school and set-up time. However, I can always refer you to an affiliated full-time contractor, electrician, etc., if needed.
    </p>
    <div class="services-grid">
      <div class="service-box" data-modal="modal-home">
        <img src="images/home-finishing.jpg" alt="Home Finishing">
        <div class="service-title">Home Finishing</div>
      </div>
      <div class="service-box" data-modal="modal-drywall">
        <img src="images/drywall-framing.jpg" alt="Drywalling/Framing">
        <div class="service-title">Drywalling/Framing</div>
      </div>
      <div class="service-box" data-modal="modal-plumbing">
        <img src="images/plumbing.jpg" alt="Plumbing">
        <div class="service-title">Plumbing</div>
      </div>
      <div class="service-box" data-modal="modal-electrician">
        <img src="images/electrician.jpg" alt="Electrician">
        <div class="service-title">Electrician</div>
      </div>
      <div class="service-box" data-modal="modal-blade">
        <img src="images/blade-smithing.jpg" alt="Blade Smithing">
        <div class="service-title">Blade Smithing</div>
      </div>
      <div class="service-box" data-modal="modal-flooring">
        <img src="images/flooring.jpg" alt="Flooring">
        <div class="service-title">Flooring</div>
      </div>
    </div>
  </section>
  
  <!-- About Section -->
  <section id="about">
    <h2>About</h2>
    <p>
      Hi, I'm Max Uribe. I handle snow removal, window cleaning, painting, and small home repairs on a personal, one-on-one basis.
      I believe in straightforward service without unnecessary fuss. For smaller tasks, I take care of everything myself,
      and for larger projects, I refer you to trusted affiliates who share my commitment to quality work.
      Thank you for considering my services—I look forward to helping keep your property in top shape.
    </p>
  </section>
  
  <!-- Contact Section -->
  <section id="contact">
    <h2>Contact</h2>
    <div class="contact-item">
      <img src="images/email-icon.png" alt="Email Icon">
      <span>uribemax1013@gmail.com</span>
    </div>
    <div class="contact-item">
      <img src="images/phone-icon.png" alt="Phone Icon">
      <span>437-881-1611</span>
    </div>
    <div class="contact-item">
      <img src="images/website-icon.png" alt="Website Icon">
      <span>
        <a href="https://litshark.ca" target="_blank" style="color:inherit; text-decoration:none;">
          litshark.ca
        </a>
      </span>
    </div>
  </section>
  
  <!-- Modal Definitions -->
  <!-- Snow Removal Modal -->
  <div id="modal-snow" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Snow Removal</h2>
      <p>
        I personally clear driveways, walkways, and small parking areas during the winter.
        When heavy snow or ice hits, you can count on me to keep your property safe and accessible—handled one-on-one.
      </p>
      <h3>Availability</h3>
      <ul>
        <li>Mon-Thurs: after 3:00pm</li>
        <li>Sat: after 7:00pm</li>
        <li>Sun: All day</li>
      </ul>
      <h3>Prices</h3>
      <h4>Integrated Apartment-House</h4>
      <p><em>"Compact Front-Entry Home"</em></p>
      <p>
        A conjoined apartment or townhouse that has no driveway after the sidewalk.
        The entrance typically consists of house steps or a porch that is 1-2 meters in length.
      </p>
      <table>
        <thead>
          <tr>
            <th>Area</th>
            <th>Cost</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1 car driveway</td>
            <td>$25</td>
          </tr>
          <tr>
            <td>Entry path/steps (clear a walk path)</td>
            <td>$5</td>
          </tr>
          <tr>
            <td>Entry path/steps (clear entire pathway edge to edge)</td>
            <td>$10</td>
          </tr>
        </tbody>
      </table>
      <h4>Extended Driveway Home</h4>
      <p><em>"Spacious Entryway Home"</em></p>
      <p>
        A detached or semi-detached house that has a continued driveway after the sidewalk and
        features a porch, steps, or pathway of more than 2 meters leading to the entrance.
      </p>
      <table>
        <thead>
          <tr>
            <th>Area</th>
            <th>Cost</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1 car driveway</td>
            <td>$30</td>
          </tr>
          <tr>
            <td>2 car driveway</td>
            <td>$50</td>
          </tr>
          <tr>
            <td>Entryway/steps (clear a walk path)</td>
            <td>$10</td>
          </tr>
          <tr>
            <td>Entryway/steps (clear entire pathway edge to edge)</td>
            <td>$20</td>
          </tr>
        </tbody>
      </table>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/snow-removal-before.jpg" alt="Before">
        <img src="images/snow-removal-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- Window Cleaning Modal -->
  <div id="modal-window" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Window Cleaning</h2>
      <p>
        Enjoy sparkling windows without the fuss. I clean both the inside and outside of your windows,
        removing dirt and streaks so you get a clear view every day.
      </p>
      <h3>Availability</h3>
      <p>Upon request during summer, limited availability outside season.</p>
      <h3>Prices</h3>
      <p>Upon quote.</p>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/window-cleaning-before.jpg" alt="Before">
        <img src="images/window-cleaning-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- Painting Modal -->
  <div id="modal-painting" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Painting</h2>
      <p>
        If you're looking to refresh your space, I offer personalized painting services for interiors and exteriors.
        I pay attention to every detail to give your home a fresh, lasting look.
      </p>
      <h3>Availability</h3>
      <p>Upon request during summer, limited availability outside season.</p>
      <h3>Prices</h3>
      <p>Upon quote.</p>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/painting-before.jpg" alt="Before">
        <img src="images/painting-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- 3D Design & Printing Modal -->
  <div id="modal-3d" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>3D Design & Printing</h2>
      <p>
        I offer 3D design and printing for custom projects. I work with you to create digital models and produce prints for prototypes, parts, or creative projects.
      </p>
      <h3>Availability</h3>
      <p>Available upon request. Turnaround time varies by project complexity.</p>
      <h3>Prices</h3>
      <p>Pricing depends on design complexity, print size, and materials. Please contact me with your project details for a quote.</p>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/3d-printing-before.jpg" alt="Before">
        <img src="images/3d-printing-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- Web Design Modal -->
  <div id="modal-webdesign" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Web Design</h2>
      <p>
        I offer web design services that focus on clean, modern aesthetics.
        Available upon request. Pricing is upon quote.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Upon quote.</p>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/web-design-before.jpg" alt="Before">
        <img src="images/web-design-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- Home Finishing Modal -->
  <div id="modal-home" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Home Finishing</h2>
      <p>
        Need a final touch for your home? I can help with small carpentry fixes, trim work, or other finishing touches.
        For bigger tasks, I’m happy to refer you to a reliable specialist.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/home-finishing-before.jpg" alt="Before">
        <img src="images/home-finishing-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- Drywalling/Framing Modal -->
  <div id="modal-drywall" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Drywalling/Framing</h2>
      <p>
        Whether you need a wall patched or a bit of framing work, I handle smaller drywall projects.
        For more extensive jobs, I can refer you to a trusted contractor.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/drywall-framing-before.jpg" alt="Before">
        <img src="images/drywall-framing-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- Plumbing Modal -->
  <div id="modal-plumbing" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Plumbing</h2>
      <p>
        Got a minor leak or a simple plumbing fix? I can take care of smaller issues, or connect you with a reliable plumber for bigger tasks.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/plumbing-before.jpg" alt="Before">
        <img src="images/plumbing-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- Electrician Modal -->
  <div id="modal-electrician" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Electrician</h2>
      <p>
        If you need a quick electrical fix—like installing a light fixture or troubleshooting a minor issue—I can help.
        For more complicated projects, I'll connect you with a trusted electrician.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/electrician-before.jpg" alt="Before">
        <img src="images/electrician-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- Blade Smithing Modal -->
  <div id="modal-blade" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Blade Smithing</h2>
      <p>
        Looking for a custom blade? One of my favorite side hobbies is knife crafting during the summer,
        and I would be happy to provide you with a strong and long lasting blade from your chosen materials.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/blade-smithing-before.jpg" alt="Before">
        <img src="images/blade-smithing-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- Flooring Modal -->
  <div id="modal-flooring" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Flooring</h2>
      <p>
        I provide flooring installation and repair services. Whether it's a repair or a new installation,
        I handle the work with care, and for larger projects, I can refer you to a trusted specialist.
      </p>
      <h3>Availability</h3>
      <p>Upon request.</p>
      <h3>Prices</h3>
      <p>Feel free to reach out for a quote.</p>
      <h3>Recent Jobs</h3>
      <div class="job-images">
        <img src="images/flooring-before.jpg" alt="Before">
        <img src="images/flooring-after.jpg" alt="After">
      </div>
    </div>
  </div>
  
  <!-- Analytics Tracking Script -->
  <script>
    /* Service Account Credentials (INSECURE: Exposed in client code) */
    const serviceAccount = {
      "type": "service_account",
      "project_id": "litshark-451902",
      "private_key_id": "cd457d9587cf9167bbbf563cfd5e27520c28b712",
      "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCgwCssn3lNbBS9\nJL1lJvQBhfY8/uBW9T8w9BPT/WnpW24h+3K1nSxAmM8iRLoCSiJbJMPd6+WXbhPg\nPPFpEzv688wmKFsPGXpsTT36QmzSZ5nXmxBpFEj+ai58rmoUe4Ld3C2cjUeA/83K\n0JbTIETsDtwzI886/ZPGChTd/BoXHx9iegLGA6V+1fmcFyeqz/BtVtDDD9MfU3Ba\njF7DeLWI48PpCoWkNawjRXra0g0VauU8XtcKEjmJcHbl9ahTiFNfBiqWBoV8XFcm\nU65yKHsRQdIMDKG3CoqpRJ7ZEgxJXNwDzJZTfFAkgr/H96yGytWlgPkOjuJo633I\nLJfhhszRAgMBAAECggEABRG6UThtBPRQSel5ylHqc1sMBliYe4JVYU/sViZeK8LV\nDyyuRxLmfXNnYmXEPErZMk81zAhJEurtcbtXEGC2Zs+l+igSPKb2VaowttuKy5UC\n/kOAeeFu+3Lrj18yrv2sHuuQ43VDGLE4bKZoszS7AUfnFfr4AumFoPYNbWiqhY/j\nwnkxf1c9OJd0Fd6jGeAySUc7+Y8HVJhXhqaP8kHdw/ct9EfSBsX/nCuLkDMX+T4S\nE6p4h7LAMCagIIQwJ3upCkRZRU5NbKvFphuoRSpAdFEjiQCraEm7Hxx6KmKqrYrG\n1KVV4yyDi58r21g7zRcgRqBnSnHIedcxW09r9o64TwKBgQDbGAVQ/s9la43NqGiu\nlr9IbwZm7yXtvY87x62/YB9x5Dv+wlBvuSCpxQp8WaLH+OHafQ6hZc9ihVuauAyo\n0UFgvqeMgTU1FrzZ5ZfnnaE0jhEO9kRarN4879KORaDULrxtBWCon3ZWVaQt0gId\nslf4IfEjN/Hd9WvMDHfJrlCoJwKBgQC71DdiBu4e0zhU6ZiG6bbuJL+EbF8D9lNu\ntNLUpjlXIt9MUnGCii0g6waE5ZxNgVvzh52tfRvF+KvlcIZm6xS0IZQmJQXkhdRR\nIhmV2YFW91SzzpHJSxAyUcFIJfAm+MqTwV7rDR9EeM2deoZkageMpU5q/tMPE4EU\n+gcFRlbGRwKBgQCw10ijQajhMdj5YK9uDFtE+ehu+STiKhkMpXWGfO2knhYW4XzP\nUNwea9601Bzhz+9szXgbqfOkkAOKdHgzYwOkNP9EF558xWeVcQ4Vc1QE+Y6nRvuR\nPOr8wI5xK55O5ZJNZQPJ1zxLH0Evgs0Wbzc2Hx9lz+g3wbpKrt2ZOkv8DQKBgBYV\nICHFQM+c852ADS+nYJtk9KND/nO/zRVR6wuXM1ycO/aEJtY7Go0pNI4BVLwD/mSG\nSDJyaAaBcuw5q4OEFd4LqJhHeAbi+RBE2w80EDHCSFIPcjJhQdk4pWmvFCnwzBhM\n/rTRySBKt5nRIuXBVXvin3KS3QuDtoRZ1ON43pDXAoGAZMXSXkcaTAQe9d7Ki8up\n6V33WdfJbiTNUkA0MrtMHoeJjK+R64IrGF5Oz9R4W6o3u7WD/HojrOaMERskturr\nrOjkERIbxvHWVou5WoRpojYrJXhC6iYGZZ9QNLLs+okN6/WsDpqx9sTUx6yulcnc\ntck8BwLBPBUEaQ0U/hQlk28=\n-----END PRIVATE KEY-----\n",
      "client_email": "litshark-service@litshark-451902.iam.gserviceaccount.com",
      "client_id": "110852862532269228908",
      "auth_uri": "https://accounts.google.com/o/oauth2/auth",
      "token_uri": "https://oauth2.googleapis.com/token",
      "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
      "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/litshark-service%40litshark-451902.iam.gserviceaccount.com",
      "universe_domain": "googleapis.com"
    };

    const SHEET_ID = "1KRQhdKB7LBT-gbpNM3snmDYzalpl3cdoYBWv_gKNXjE";
    const SHEET_RANGE = "Sheet1!A1";

    // Utility functions for JWT
    function pemToArrayBuffer(pem) {
      const b64 = pem.replace(/-----BEGIN PRIVATE KEY-----/, '')
                     .replace(/-----END PRIVATE KEY-----/, '')
                     .replace(/\n/g, '');
      const binaryString = atob(b64);
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      return bytes.buffer;
    }

    function base64urlEncode(str) {
      return btoa(str)
        .replace(/\+/g, '-')
        .replace(/\//g, '_')
        .replace(/=+$/, '');
    }

    function base64urlEncodeBuffer(buffer) {
      let binary = '';
      const bytes = new Uint8Array(buffer);
      for (let i = 0; i < bytes.byteLength; i++) {
        binary += String.fromCharCode(bytes[i]);
      }
      return base64urlEncode(binary);
    }

    async function signJWT(header, payload, privateKeyPem) {
      const encoder = new TextEncoder();
      const headerEncoded = base64urlEncode(JSON.stringify(header));
      const payloadEncoded = base64urlEncode(JSON.stringify(payload));
      const data = encoder.encode(headerEncoded + "." + payloadEncoded);

      const keyBuffer = pemToArrayBuffer(privateKeyPem);
      const cryptoKey = await window.crypto.subtle.importKey(
        "pkcs8",
        keyBuffer,
        { name: "RSASSA-PKCS1-v1_5", hash: "SHA-256" },
        false,
        ["sign"]
      );

      const signature = await window.crypto.subtle.sign("RSASSA-PKCS1-v1_5", cryptoKey, data);
      const signatureEncoded = base64urlEncodeBuffer(signature);
      return `${headerEncoded}.${payloadEncoded}.${signatureEncoded}`;
    }

    async function getAccessToken() {
      const now = Math.floor(Date.now() / 1000);
      const header = { alg: "RS256", typ: "JWT" };
      const payload = {
        iss: serviceAccount.client_email,
        scope: "https://www.googleapis.com/auth/spreadsheets",
        aud: serviceAccount.token_uri,
        iat: now,
        exp: now + 3600
      };
      const jwt = await signJWT(header, payload, serviceAccount.private_key);
      const params = new URLSearchParams();
      params.append("grant_type", "urn:ietf:params:oauth:grant-type:jwt-bearer");
      params.append("assertion", jwt);
      const response = await fetch(serviceAccount.token_uri, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: params
      });
      const data = await response.json();
      return data.access_token;
    }

    async function appendRowToSheet(accessToken, rowData) {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_RANGE}:append?valueInputOption=RAW`;
      const body = { values: [rowData] };
      const response = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${accessToken}`
        },
        body: JSON.stringify(body)
      });
      return await response.json();
    }

    async function logVisitor() {
      const visitorData = {
        time: new Date().toISOString(),
        userAgent: navigator.userAgent,
        url: window.location.href
      };
      try {
        const ipResponse = await fetch("https://api.ipify.org?format=json");
        const ipData = await ipResponse.json();
        visitorData.ip = ipData.ip;
      } catch (err) {
        visitorData.ip = "Unavailable";
      }
      const row = [visitorData.time, visitorData.ip, visitorData.userAgent, visitorData.url];
      try {
        const token = await getAccessToken();
        await appendRowToSheet(token, row);
        console.log("Visitor logged:", row);
      } catch (error) {
        console.error("Error logging visitor:", error);
      }
    }

    window.addEventListener("load", () => {
      logVisitor();
    });
  </script>
</body>
</html>
